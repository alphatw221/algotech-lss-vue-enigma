import{b as N,r as c,A as v,j as n,c as l,d as t,N as z,O as E,ad as G,ae as J,L as _,T as D,e as g,a0 as V,aB as q,_ as Q,u as R,a as A,o as U,a1 as Y,aC as Z,F as S,f as F,t as B,M,a4 as ee,aD as te,h as se,av as oe,aE as ne,aF as ae,aG as j}from"./lss.js";import{_ as le}from"./LoadingTable_lss.js";const re={class:"flex content-end justify-start gap-3 mr-auto justify-items-stretch"},ce={class:"items-center w-auto flex mt-auto"},ie={class:"relative"},ue=["placeholder"],me={class:"flex flex-row items-center"},de={__name:"BuyersSearchBar",setup(I){const T=N(),x=V().appContext.config.globalProperties.eventBus,d=c(""),u=c({source_email:"",target_email:""}),m=()=>{x.emit("BuyerSearch",{keyword:d.value})},b=()=>{d.value="",x.emit("BuyerSearch",{keyword:d.value})},C=()=>{q(u.value,T.alert).then(k=>{m()})};return(k,s)=>{const r=v("SearchIcon"),a=v("XIcon"),i=v("ChevronsRightIcon");return n(),l("form",null,[t("div",re,[t("div",ce,[t("div",ie,[z(t("input",{type:"text",class:"shrink h-[35px] sm:h-[42px] w-40 lg:w-72 pr-10 rounded-lg",placeholder:k.$t("buyers.search_bar.search")+"...","onUpdate:modelValue":s[0]||(s[0]=o=>d.value=o),onKeydown:s[1]||(s[1]=G(J(o=>m(),["prevent"]),["enter"]))},null,40,ue),[[E,d.value]]),_(r,{class:"absolute w-7 h-7 top-1 sm:top-2 right-3 z-10 text-slate-600",onClick:s[2]||(s[2]=o=>m())})]),d.value?(n(),D(a,{key:0,class:"flex-none w-7 h-7 mt-2 ml-2 text-slate-600",onClick:s[3]||(s[3]=o=>b())})):g("",!0)]),t("div",me,[z(t("input",{class:"form-control",type:"text",placeholder:"Source Email","onUpdate:modelValue":s[4]||(s[4]=o=>u.value.source_email=o)},null,512),[[E,u.value.source_email]]),_(i,{class:"w-8 h-8"}),z(t("input",{class:"form-control",type:"text",placeholder:"Target Email","onUpdate:modelValue":s[5]||(s[5]=o=>u.value.target_email=o)},null,512),[[E,u.value.target_email]]),t("button",{type:"button",class:"btn btn-primary ml-2",onClick:s[6]||(s[6]=o=>C())},"Merge")])])])}}};const pe={key:1,class:"overflow-x-hidden sm:overflow-auto sm:h-[62vh] mt-4"},_e={class:"table -mt-3 table-report"},fe={key:0,class:"text-left"},he={key:0,class:"w-fit"},ye=["data-content"],ge={key:2,class:"text-left w-5 w-fit"},ve={class:"flex justify-center"},xe={class:"w-fit h-fit image-fit"},be={class:"flex-none w-20 h-20 sm:mr-1 sm:w-12 sm:h-12 image-fit"},ke=["src"],we=["data-content"],Ce=["onClick"],$e={class:"mr-3 sm:hidden"},Se=["data-content"],Be=["onClick"],Ie={class:"mr-3 sm:hidden"},Pe={class:"flex flex-wrap items-center intro-y sm:flex-row sm:flex-nowrap"},Le={__name:"BuyersListTable",props:{tableColumns:Array},emits:["showRemindModal"],setup(I,{emit:T}){R();const P=A(),d=V().appContext.config.globalProperties.eventBus,u=c(1);c(1);const m=c(50),b=c(0);c("");const C=c("");c("created_at"),c(!0);const k=N(),s=c(!0),r=c([]);U(()=>{a(),s.value=!0,d.on("BuyerSearch",e=>{u.value=1,C.value=e.keyword,a()})}),Y(()=>{d.off("BuyerSearch")});const a=()=>{s.value=!0,r.value=[],Z(C.value,u.value,m.value,k.alert).then(e=>{e.data.count!=null&&(b.value=e.data.count),r.value=e.data.results,s.value=!1})},i=e=>{u.value=e,a()},o=e=>{m.value=e,a()},p=e=>{P.push({name:"seller-buyers-order-history",params:{buyer_id:e.id}})},f=e=>{P.push({name:"seller-buyers-points",params:{buyer_id:e.id}})},w=e=>{var $,L;return($=e.facebook_info)!=null&&$.picture?e.facebook_info.picture:(L=e.google_info)!=null&&L.picture?e.google_info.picture:"https://storage.googleapis.com/lss_public_bucket/static/fake_head.jpeg"};return(e,$)=>{const L=v("ShoppingBagIcon"),O=v("Tippy"),H=v("SimpleIcon"),K=v("Page");return n(),l(S,null,[s.value==!0?(n(),D(le,{key:0,column:I.tableColumns,tableName:"buyers",theadColor:"#E2E8F0"},null,8,["column"])):s.value==!1?(n(),l("div",pe,[t("table",_e,[t("thead",null,[t("tr",null,[(n(!0),l(S,null,F(I.tableColumns,h=>(n(),l("th",{class:"text-center whitespace-nowrap",key:h.key},[h.key!==null?(n(),l("div",fe,B(e.$t("buyers.table_column."+h.name)),1)):g("",!0)]))),128))])]),t("tbody",null,[(n(!0),l(S,null,F(r.value,(h,W)=>(n(),l("tr",{key:W,class:"intro-x"},[(n(!0),l(S,null,F(I.tableColumns,y=>(n(),l(S,{key:y.key},[y.key=="customer_name"?(n(),l("td",he,B(h.name),1)):g("",!0),y.key=="email"?(n(),l("td",{key:1,class:"w-fit","data-content":e.$t("buyers.table_column."+y.key)},B(h.email),9,ye)):g("",!0),y.key=="customer_img"?(n(),l("td",ge,[t("div",ve,[t("div",xe,[t("div",be,[t("img",{class:"rounded-full",src:w(h)},null,8,ke)])])])])):g("",!0),y.key=="order_history"?(n(),l("td",{key:3,class:"items-center manage_order w-fit","data-content":e.$t("buyers.table_column."+y.key)},[t("a",{class:"flex items-center justify-center",onClick:X=>p(h)},[t("span",$e,B(e.$t("buyers.table_column.order_history")),1),_(O,{content:e.$t("buyers.table_column.order_history"),options:{theme:"light"}},{default:M(()=>[_(L,{color:"#2d8cf0",width:"30",height:"32"})]),_:1},8,["content"])],8,Ce)],8,we)):g("",!0),y.key=="points"?(n(),l("td",{key:4,class:"items-center manage_order w-fit","data-content":e.$t("buyers.table_column."+y.key)},[t("a",{class:"flex items-center justify-center",onClick:X=>f(h)},[t("span",Ie,B(e.$t("buyers.table_column.points")),1),_(O,{content:e.$t("buyers.table_column.points"),options:{theme:"light"}},{default:M(()=>[_(H,{color:"#2d8cf0",icon:"point",width:"30",height:"32"})]),_:1},8,["content"])],8,Be)],8,Se)):g("",!0)],64))),128))]))),128))])])])):g("",!0),t("div",Pe,[_(K,{class:"mx-auto my-3 flex flex-row flex-wrap justify-center gap-1 mb-10",total:b.value,"page-size":m.value,"show-sizer":"","page-size-opts":[20,50,100,500,1e3],onOnChange:i,onOnPageSizeChange:o},null,8,["total","page-size"])])],64)}}};var Te=Q(Le,[["__scopeId","data-v-bc542b60"]]);const je={class:"flex flex-col lg:mt-8 my-3 gap-5 h-fit sm:h-full"},De={class:"text-xl sm:text-2xl sm:px-20 mx-auto sm:mx-0 font-medium"},ze={class:"flex flex-col px-3 sm:px-8 py-5 box h-full lg:mx-20 gap-4"},Ee={class:"flex flex-row"},Fe=t("span",{class:"hidden sm:inline-block text-md font-bold text-[#ff9505] align-middle flex flex-row"},"Import Customer",-1),Ve={__name:"Main",setup(I){const{cookies:T}=ee(),P=T.get("access_token"),x=N();te(),R(),A(),V().appContext.config.globalProperties.eventBus,c([{text:"name",value:"name"}]);const u=c([{name:null,key:"customer_img"},{name:"customer_name",key:"customer_name"},{name:"email",key:"email"},{name:"order_history",key:"order_history"},{name:"points",key:"points"}]);U(()=>{x.buyer={}});const m=c(!1),b=c(null),C=r=>{m.value=!0,b.value=r,k(!0)},k=r=>{const a=new WebSocket(`wss://v2login.liveshowseller.com/ws/data/import/?token=${P}`);a.onmessage=i=>{const o=JSON.parse(i.data);if(o.type==="room_data"&&r){let p=new FormData;p.append("file",b.value),p.append("room_id",o.room_id),ne(p,x.alert).then(f=>{console.log(f.data)}).catch(f=>{console.log("upload file error"),a.close(1e3)})}else o.type==="result_data"&&(console.log(o),o.data.result=="complete"?location.reload():x.alert.showMessageToast("Import Fail, Please try again or contect support team."),a.close(1e3))},a.onopen=i=>{console.log("socket connected")},a.onclose=i=>{i.code!=1e3&&k(!1),console.error("socket closed"),m.value=!1},a.onerror=function(i){console.error("Socket encountered error: ",i.message,"Closing socket"),a.close(1e3)}},s=()=>{ae().then(r=>{const a=r.data.data,i=r.data.header,o=r.data.display_header,p=r.data.column_settings,f=[o,...a],w=j.exports.utils.json_to_sheet(f,{header:i,skipHeader:!0});w["!cols"]=p;const e=j.exports.utils.book_new();j.exports.utils.book_append_sheet(e,w,"sheets"),j.exports.writeFile(e,"sheets.xlsx")})};return(r,a)=>{var p,f,w,e,$;const i=v("LoadingIcon"),o=v("ArrowDownIcon");return n(),l("div",je,[t("h2",De,B(r.$t("buyers.page_title")),1),t("div",ze,[t("div",Ee,[_(de,{class:"my-auto"}),($=(e=(w=(f=(p=se(x))==null?void 0:p.userInfo)==null?void 0:f.user_subscription)==null?void 0:w.user_plan)==null?void 0:e.display)!=null&&$.import_customer_button?(n(),D(oe,{key:0,class:"ml-auto text-sm h-[35px] w-[35px] p-0 sm:p-2 sm:w-fit sm:h-[42px] text-[#ff9505] bg-[#fefce8] font-medium shadow-lg border-[#fcd34d] hover:bg-[#fef6e8] rounded-full border-[2px]",button_id:"import_customer",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",multiple:!1,uploadFunction:C},{default:M(()=>[m.value?(n(),D(i,{key:0,icon:"three-dots",color:"black",class:"absolute h-[30px] w-[30px] sm:w-40 mr-2 sm:mr-0 sm:h-[20px] top-2"})):(n(),l(S,{key:1},[_(o,{class:"w-6 h-6"}),Fe],64))]),_:1})):g("",!0),t("button",{class:"btn btn-primary ml-2 w-[120px]",onClick:a[0]||(a[0]=L=>s())}," Export Points")]),_(Te,{tableColumns:u.value},null,8,["tableColumns"])])])}}};export{Ve as default};
