import{u as J,a as K,a0 as Q,b as W,s as X,r as m,w as T,x as Y,o as Z,a5 as ee,A as B,c as r,d as e,t as o,h as i,N as _,S as $,F as g,f as h,e as k,L as z,M as P,O as j,$ as H,B as q,H as ae,E as te,a6 as le,i as b,a7 as se,j as n}from"./lss.js";import{r as oe,e as re,u as ne}from"./campaign_lucky_draw_lss.js";const ie={class:"px-5 sm:px-10"},de={class:"mt-5 flex justify-self-start"},ce={class:"form-label mr-10"},ue={style:{display:"inline-block","font-weight":"700"}},_e={class:"flex flex-col"},me={class:"lg:flex"},pe={class:"lg:w-[50%] flex flex-col lg:mr-5 mt-6"},we={class:"form-label text-base"},ve={key:0,class:"w-40",disabled:""},ye=["value"],fe={key:0,class:"text-danger text-[14px] leading-tight"},ge={class:"lg:w-[50%] flex-col mt-6"},he={class:"flex"},ke={class:"form-label text-base"},be=["value"],xe={class:"lg:flex"},$e={class:"lg:w-[50%] flex-col lg:mr-5 mt-6"},ze={class:"form-label text-base"},Ce={key:0,class:"text-danger text-[14px] leading-tight"},Ve={class:"lg:w-[50%] flex-col mt-6"},Me={class:"flex"},Te={class:"form-label text-base"},De={class:"flex sm:flex-row mt-2 justify-between"},Le={class:"flex w-36"},Se={class:"form-check mr-5"},Ue={class:"form-check-label",for:"radio-switch-yes"},Be={class:"form-check sm:mr-5"},Pe={class:"form-check-label",for:"radio-switch-no"},je={class:"lg:flex"},He={class:"lg:w-[50%] flex-col mt-6"},qe={class:"form-label text-base"},Ae=["value"],Ne={key:0,class:"lg:w-[50%] flex flex-col mt-6 sm:mr-5"},Re={class:"flex"},Ee={class:"form-label text-base"},Fe={key:0,class:"w-40",disabled:""},Ie=["value"],Oe={key:0,class:"text-danger text-[14px]"},Ge={key:1,class:"lg:w-[50%] flex-col sm:ml-5 mt-3"},Je={class:"form-label text-base mt-3"},Ke={key:0,class:"text-danger text-[14px]"},Qe={key:2,class:"lg:w-[50%] flex mt-3 sm:mr-5 justify-center"},We={key:0,class:"form-label text-danger mt-auto text-[14px] md:text-[16px]"},Xe={key:3,class:"lg:w-[50%] flex flex-col mt-3 sm:mr-5"},Ye={class:"lg:flex"},Ze={class:"lg:w-[100%] flex-col mt-6"},ea={class:"flex justify-between"},aa={class:"form-label text-base mr-auto my-auto"},ta={class:"btn btn-primary bg-[#070130] w-48 sm:w-fit shadow-md sm:mt-auto lg:sm:mr-5 text-base"},la={for:"upload",id:"create_animation"},sa={class:"flex flex-wrap items-center mt-5"},oa={class:"w-24 h-24 image-fit relative mr-11"},ra=["src"],na={class:"w-24 h-24 image-fit relative mr-11"},ia=["src"],da=["onClick"],ca=["src"],ua={class:"flex justify-end my-12 text-base"},va={__name:"CreateEditLuckyDraw",setup(_a){const v=J(),A=K();Q().appContext.config.globalProperties.eventBus;const d=W(),p=X(),y="https://storage.googleapis.com/lss_bucket/static/",N=m([{value:5,name:"5 secs"},{value:10,name:"10 secs"},{value:20,name:"20 secs"},{value:30,name:"30 secs"},{value:60,name:"60 secs"}]),R=m([{value:"like",name:"by like this post"},{value:"purchase",name:"by purchased any product"},{value:"product",name:"by purchased certain product"},{value:"keyword",name:"by keyword"},{value:"sharedpost",name:"By shared the post"},{value:"like_and_comment",name:"By like and comment this post"}]),D=T(()=>(console.log(p.campaignProducts),p.campaignProducts.filter(a=>a.type=="lucky_draw"))),C=m([]),l=m({spin_time:5,num_of_winner:0,repeatable:!1,type:"like",comment:"",campaign_product_id:null,campaign_product:{},prize_id:null,prize:{qty_for_sale:99999},title:"",animation:`${y}lucky_draw1.svg`});m(null);const f=m(!1),L=m({maximum_size:10*1024*1024,supported_type:"image"}),E=T(()=>{var a;return{prize:{required:q},num_of_winner:{required:q,integer:ae,minValue:te(1),maxValue:le((a=l.value.prize)==null?void 0:a.qty_for_sale)}}}),w=Y(E,l),V=T(()=>v.params.lucky_draw_id?"edit":"create");Z(()=>{F(),V.value==="edit"&&oe(v.params.lucky_draw_id,d.alert).then(a=>{var s,u;l.value=a.data,l.value.prize_id=((s=a.data.prize)==null?void 0:s.id)||null,l.value.campaign_product_id=((u=a.data.campaign_product)==null?void 0:u.id)||null})});const F=()=>{ee(d.alert).then(a=>{C.value=a.data})},I=()=>{if(l.value.type==="product"&&typeof l.value.campaign_product_id==null){f.value=!0;return}else if(l.value.type==="keyword"&&l.value.comment===""){f.value=!0;return}else f.value=!1;if(w.value.$touch(),w.value.$invalid){d.alert.showMessageToast(b.global.t("lucky_draw.invalid_data"));return}console.log(l.value),V.value=="create"?re(v.params.campaign_id,l.value,d.alert).then(a=>{d.notification.showMessageToast(b.global.t("lucky_draw.create_successed")),M()}):V.value=="edit"&&ne(v.params.lucky_draw_id,l.value,d.alert).then(a=>{d.notification.showMessageToast(b.global.t("lucky_draw.update_successed")),M()})},M=()=>{A.push({name:"lucky-draw-list",params:{campaign_id:v.params.campaign_id}})},O=a=>{const s=a.target.files[0];if(G(s)){const u=new FormData;u.append("animation",s),se(u,d.alert).then(x=>{C.value.push(x.data)})}},G=a=>a.type.includes(L.value.supported_type)?a.size>L.value.maximum_size?(d.alert.showMessageToast(b.global.t("lucky_draw.animation_size_err")),!1):!0:(d.alert.showMessageToast(b.global.t("lucky_draw.animation_type_err")),!1);return(a,s)=>{var S,U;const u=B("HelpCircleIcon"),x=B("Tippy");return n(),r("div",ie,[e("div",de,[e("label",ce,o(a.$t("lucky_draw.draw_create.campaign_title"))+" : ",1),e("h2",ue,o((S=i(p).campaign)==null?void 0:S.title),1)]),e("div",_e,[e("div",me,[e("div",pe,[e("label",we,o(a.$t("lucky_draw.draw_create.prize")),1),_(e("select",{id:"prizeSelect",class:"w-full form-select sm:form-select-lg rounded-lg","onUpdate:modelValue":s[0]||(s[0]=t=>l.value.prize_id=t)},[D.value.length?(n(!0),r(g,{key:1},h(D.value,(t,c)=>(n(),r("option",{key:c,value:t.id,class:"w-40"},o(t.name),9,ye))),128)):(n(),r("option",ve,o(a.$t("lucky_draw.draw_create.assign_prize_err")),1))],512),[[$,l.value.prize_id]]),i(w).prize.$error?(n(),r("label",fe,o(a.$t("lucky_draw.draw_create.assign_prize_err")),1)):k("",!0)]),e("div",ge,[e("div",he,[e("label",ke,o(a.$t("lucky_draw.draw_create.spin_time")),1),z(x,{class:"rounded-full w-30 whitespace-wrap","data-tippy-allowHTML":"true","data-tippy-placement":"right",content:a.$t("tooltips.lucky_draw.spin_time"),theme:"light"},{default:P(()=>[z(u,{class:"w-8 ml-1 mt-0.5 tippy-icon"})]),_:1},8,["content"])]),_(e("select",{class:"w-full form-select sm:form-select-lg rounded-lg","onUpdate:modelValue":s[1]||(s[1]=t=>l.value.spin_time=t)},[(n(!0),r(g,null,h(N.value,(t,c)=>(n(),r("option",{key:c,value:t.value},o(t.value)+" "+o(a.$t("lucky_draw.draw_create.secs")),9,be))),128))],512),[[$,l.value.spin_time]])])]),e("div",xe,[e("div",$e,[e("label",ze,o(a.$t("lucky_draw.draw_create.number_of_winner")),1),_(e("input",{type:"text",class:"form-control lg:mr-5","onUpdate:modelValue":s[2]||(s[2]=t=>i(w).num_of_winner.$model=t)},null,512),[[j,i(w).num_of_winner.$model,void 0,{trim:!0}]]),i(w).num_of_winner.$error?(n(),r("label",Ce,o(a.$t("lucky_draw.draw_create.number_winner_warning"))+" "+o((U=l.value.prize)==null?void 0:U.qty_for_sale),1)):k("",!0)]),e("div",Ve,[e("div",Me,[e("label",Te,o(a.$t("lucky_draw.draw_create.winner_repeat")),1),z(x,{class:"rounded-full w-30 whitespace-wrap","data-tippy-allowHTML":"true","data-tippy-placement":"right",content:a.$t("tooltips.lucky_draw.winner_repeat"),theme:"light"},{default:P(()=>[z(u,{class:"w-8 ml-1 mt-0.5 tippy-icon"})]),_:1},8,["content"])]),e("div",De,[e("div",Le,[e("div",Se,[_(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":s[3]||(s[3]=t=>l.value.repeatable=t),value:!0},null,512),[[H,l.value.repeatable]]),e("label",Ue,o(a.$t("lucky_draw.draw_create.yes")),1)]),e("div",Be,[_(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":s[4]||(s[4]=t=>l.value.repeatable=t),value:!1},null,512),[[H,l.value.repeatable]]),e("label",Pe,o(a.$t("lucky_draw.draw_create.no")),1)])])])])]),e("div",je,[e("div",He,[e("label",qe,o(a.$t("lucky_draw.draw_create.draw_type")),1),_(e("select",{class:"w-full form-select sm:form-select-lg rounded-lg sm:mr-5 text-base","onUpdate:modelValue":s[5]||(s[5]=t=>l.value.type=t)},[(n(!0),r(g,null,h(R.value,(t,c)=>(n(),r("option",{key:c,value:t.value},o(a.$t(`lucky_draw.draw_create.draw_selection.${t.value}`)),9,Ae))),128))],512),[[$,l.value.type]])]),l.value.type==="product"?(n(),r("div",Ne,[e("div",Re,[e("label",Ee,o(a.$t("lucky_draw.draw_create.product")),1)]),_(e("select",{class:"w-full form-select sm:form-select-lg rounded-lg ml-0 sm:ml-5","onUpdate:modelValue":s[6]||(s[6]=t=>l.value.campaign_product_id=t)},[i(p).campaignProducts.length==0?(n(),r("option",Fe,o(a.$t("lucky_draw.draw_create.assign_product_err")),1)):(n(!0),r(g,{key:1},h(i(p).campaignProducts,(t,c)=>(n(),r("option",{key:c,value:t.id},o(`(${t.order_code})   ${t.name}`),9,Ie))),128))],512),[[$,l.value.campaign_product_id]]),f.value?(n(),r("label",Oe,o(a.$t("lucky_draw.draw_create.campaign_product_warning")),1)):k("",!0)])):l.value.type==="keyword"?(n(),r("div",Ge,[e("label",Je,o(a.$t("lucky_draw.draw_create.keyword")),1),_(e("textarea",{class:"w-full h-14 overflow-hidden whitespace-pre-line p-1 rounded-lg","onUpdate:modelValue":s[7]||(s[7]=t=>l.value.comment=t)},null,512),[[j,l.value.comment]]),f.value?(n(),r("label",Ke,o(a.$t("lucky_draw.draw_create.keyword_warning")),1)):k("",!0)])):l.value.type==="purchased"?(n(),r("div",Qe,[i(p).campaignProducts.length==0?(n(),r("label",We,o(a.$t("lucky_draw.draw_create.no_product_err")),1)):k("",!0)])):(n(),r("div",Xe))]),e("div",Ye,[e("div",Ze,[e("div",ea,[e("label",aa,o(a.$t("lucky_draw.draw_create.animation_style")),1),e("div",ta,[e("input",{type:"file",id:"upload",onChange:s[8]||(s[8]=t=>O(t)),hidden:""},null,32),e("label",la,"+ "+o(a.$t("lucky_draw.draw_create.upload_animation")),1)])]),e("div",sa,[e("div",oa,[e("input",{type:"radio",checked:"",class:"rounded-full vertical-center absolute top-0 left-0 z-50",name:"check_animation",onClick:s[9]||(s[9]=t=>l.value.animation=`${i(y)}lucky_draw1.svg`)}),e("img",{class:"rounded-full",src:`${i(y)}lucky_draw1.svg`},null,8,ra)]),e("div",na,[e("input",{type:"radio",class:"rounded-full vertical-center absolute top-0 left-0 z-50",name:"check_animation",onClick:s[10]||(s[10]=t=>l.value.animation=`${i(y)}lucky_draw2.svg`)}),e("img",{class:"rounded-full",src:`${i(y)}lucky_draw2.svg`},null,8,ia)]),(n(!0),r(g,null,h(C.value,(t,c)=>(n(),r("div",{key:c,class:"w-24 h-24 image-fit relative mr-11"},[e("input",{type:"radio",class:"rounded-full vertical-center absolute top-0 left-0 z-50",name:"check_animation",onClick:ma=>l.value.animation=t.path},null,8,da),e("img",{class:"rounded-full",src:t.path},null,8,ca)]))),128))])])])]),e("div",ua,[e("button",{class:"w-32 bg-white btn dark:border-darkmode-400",onClick:s[11]||(s[11]=t=>M())},o(a.$t("lucky_draw.draw_create.cancel")),1),e("button",{class:"w-32 ml-5 shadow-md btn btn-primary",onClick:s[12]||(s[12]=t=>I())},o(a.$t("lucky_draw.draw_create.save")),1)])])}}};export{va as default};
